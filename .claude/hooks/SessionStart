#!/usr/bin/env bash
set -eo pipefail

# SessionStart hook for TLDRScraper project
# This hook:
# 1. Sources setup.sh to configure the environment
# 2. Reads all markdown files in the root directory
# 3. Provides them as additional context to Claude

# Get the project root directory (parent of .claude)
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
cd "$PROJECT_ROOT"

# Source setup.sh
source "$PROJECT_ROOT/setup.sh" 1>/tmp/setup_sh_output.log 2>&1

# Build additional context from markdown files
CONTEXT=""
CONTEXT+="# Project Documentation\n\n"
CONTEXT+="---\n\n"
CONTEXT+="$(</tmp/setup_sh_output.log)"


# Output the hook result in the required JSON format
# Using jq to properly escape the context string
ESCAPED_CONTEXT=$(echo -e "$CONTEXT" | jq -Rs .)

cat << EOF
{
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": $ESCAPED_CONTEXT
  }
}
EOF

exit 0
