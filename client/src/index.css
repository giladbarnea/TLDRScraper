@import "tailwindcss";
@import url('https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap');
@plugin "@tailwindcss/typography";

@theme {
  --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-display: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-serif: "Lora", serif;

  --color-brand-50: #f0f9ff;
  --color-brand-100: #e0f2fe;
  --color-brand-200: #bae6fd;
  --color-brand-300: #7dd3fc;
  --color-brand-400: #38bdf8;
  --color-brand-500: #0ea5e9;
  --color-brand-600: #0284c7;
  --color-brand-700: #0369a1;
  --color-brand-800: #075985;
  --color-brand-900: #0c4a6e;

  --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
  --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.08), 0 1px 4px rgba(0, 0, 0, 0.04);

  --ease-springy: cubic-bezier(0.16, 1, 0.3, 1);
}

@layer base {
  body {
    @apply bg-slate-50 text-slate-900 antialiased;
  }
}

.prose h1,
.prose-sm h1 {
  margin-top: 1.2em;
  margin-bottom: 0.5em;
}

.prose h2 {
  margin-top: 1.4em;
  margin-bottom: 0.4em;
}

/* 0-indent list overrides */
.prose ul,
.prose ol {
  padding-left: 1.2em; /* Aligns bullet with regular text (p) start */
}

.prose li {
  padding-left: 0;
  margin-left: 0;
}

@keyframes zen-enter {
  from {
    opacity: 0;
    transform: translateY(12px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@utility animate-zen-enter {
  animation: zen-enter 300ms var(--ease-springy) forwards;
}

@keyframes check-enter {
  from {
    transform: scale(0);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@utility animate-check-enter {
  animation: check-enter 150ms var(--ease-springy) forwards;
}

/*
 * ── Article card border glow — lifecycle animation system ──
 *
 * One ::after pseudo-element on [data-touch-phase] drives all border effects.
 * Two independent state machines project onto it via data-* attributes:
 *
 *   Touch phase (JS → data-touch-phase):   idle → pressed → released → idle
 *   Summary data (JS → data-summary-status): unknown → loading → available
 *
 * Visual timeline (what the user sees):
 *
 *   t=0ms     pointerDown     Border ignites at touch point (short bright arc)
 *   0–500ms   holding         Fuse burns outward (arc grows from 6% → 32% of perimeter)
 *   ~150ms    pointerUp       Circuit snaps shut (fast expansion to 50%, brief surge pulse)
 *   ~150ms    loading starts  released+loading overlap: fuse crossfades into spark orbit
 *   ~550ms    released ends   Spark orbit takes over (one bright bead lapping the border)
 *   …         server work     Spark runs steady 2.5s laps
 *   ~5–30s    response        Full-border arrival flash (~125ms hold), then fade out
 *             overlay opens   Zen overlay mounts via zen-enter animation
 *
 * Colors: hsl(210, …) cool blue-white family. Core filament at 72–82% lightness,
 * bright leading edges at 95% saturation. Visible on white without going neon.
 *
 * Custom properties (GPU-composited via @property):
 *   --fuse-progress   <percentage>  Angular extent of the fuse arc
 *   --border-angle    <angle>       Rotation angle for spark orbit
 *   --spark-visibility <number>     Crossfade: 0 = fuse only, 1 = spark visible
 *   --fuse-strength   <number>      Crossfade: 1 = fuse full, 0 = fuse hidden
 *   --surge           <number>      Full-border brightness pulse (circuit-surge keyframes)
 *   --touch-angle     (set by JS)   Angle from card center to touch point (gradient origin)
 *
 * Cancellation: scroll (move > 10px) or long-press (≥500ms) → pressed→idle,
 * no release snap, border fades via 220ms opacity transition.
 *
 * prefers-reduced-motion: looping spark-orbit wrapped in no-preference query;
 * reduced-motion users get a static angled gradient.
 */

/* ── Border glow: registered custom properties for GPU-composited animation ── */

@property --fuse-progress {
  syntax: '<percentage>';
  inherits: false;
  initial-value: 6%;
}

@property --border-angle {
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}

@property --spark-visibility {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

@property --fuse-strength {
  syntax: '<number>';
  inherits: false;
  initial-value: 1;
}

@property --surge {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

/* ── Border glow pseudo-element (article card touch/summary lifecycle) ── */

[data-touch-phase]::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 1.5px;
  pointer-events: none;
  z-index: 20;
  opacity: 0;
  --fuse-progress: 6%;
  --spark-visibility: 0;
  --fuse-strength: 1;
  --surge: 0;
  --base-glow: 0;
  background:
    conic-gradient(
      from var(--touch-angle, 0deg),
      hsl(210 85% 82% / calc(0.85 * var(--fuse-strength))) 0%,
      hsl(210 85% 82% / calc(0.75 * var(--fuse-strength))) 0.8%,
      hsl(210 70% 86% / calc(0.32 * var(--fuse-strength))) calc(var(--fuse-progress) - 1.6%),
      hsl(210 95% 72% / calc(0.95 * var(--fuse-strength))) calc(var(--fuse-progress) - 0.35%),
      transparent var(--fuse-progress),
      transparent calc(100% - var(--fuse-progress)),
      hsl(210 95% 72% / calc(0.95 * var(--fuse-strength))) calc(100% - var(--fuse-progress)),
      hsl(210 70% 86% / calc(0.32 * var(--fuse-strength))) calc(100% - var(--fuse-progress) + 1.25%),
      hsl(210 85% 82% / calc(0.75 * var(--fuse-strength))) calc(100% - 0.8%),
      hsl(210 85% 82% / calc(0.85 * var(--fuse-strength))) 100%
    ),
    conic-gradient(
      from 0deg,
      hsl(210 95% 78% / calc(0.75 * var(--surge))) 0 100%
    ),
    conic-gradient(
      from 0deg,
      hsl(210 70% 82% / var(--base-glow)) 0 100%
    );
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  mask-composite: exclude;
  transition:
    opacity 220ms ease,
    --spark-visibility 320ms ease-out,
    --fuse-strength 260ms ease-out;
}

[data-touch-phase="pressed"]::after {
  opacity: 1;
  --fuse-progress: 32%;
  --base-glow: 0.08;
  transition: opacity 0ms, --fuse-progress 500ms ease-out;
}

[data-touch-phase="released"]::after {
  opacity: 1;
  --fuse-progress: 50%;
  --base-glow: 0.1;
  animation: circuit-surge 220ms ease-out both;
  transition: opacity 0ms, --fuse-progress 120ms ease-in;
}

[data-touch-phase="released"][data-summary-status="loading"]::after {
  opacity: 1;
  --spark-visibility: 1;
  --fuse-strength: 0.35;
  --base-glow: 0.1;
  background:
    conic-gradient(
      from var(--border-angle),
      transparent 0%,
      hsl(210 95% 76% / calc(0.95 * var(--spark-visibility))) 2%,
      hsl(210 90% 82% / calc(0.75 * var(--spark-visibility))) 4.5%,
      hsl(210 70% 88% / calc(0.24 * var(--spark-visibility))) 9.5%,
      transparent 12%,
      transparent 100%
    ),
    conic-gradient(
      from var(--touch-angle, 0deg),
      hsl(210 85% 82% / calc(0.85 * var(--fuse-strength))) 0%,
      hsl(210 85% 82% / calc(0.75 * var(--fuse-strength))) 0.8%,
      hsl(210 70% 86% / calc(0.32 * var(--fuse-strength))) calc(var(--fuse-progress) - 1.6%),
      hsl(210 95% 72% / calc(0.95 * var(--fuse-strength))) calc(var(--fuse-progress) - 0.35%),
      transparent var(--fuse-progress),
      transparent calc(100% - var(--fuse-progress)),
      hsl(210 95% 72% / calc(0.95 * var(--fuse-strength))) calc(100% - var(--fuse-progress)),
      hsl(210 70% 86% / calc(0.32 * var(--fuse-strength))) calc(100% - var(--fuse-progress) + 1.25%),
      hsl(210 85% 82% / calc(0.75 * var(--fuse-strength))) calc(100% - 0.8%),
      hsl(210 85% 82% / calc(0.85 * var(--fuse-strength))) 100%
    ),
    conic-gradient(
      from 0deg,
      hsl(210 95% 78% / calc(0.75 * var(--surge))) 0 100%
    ),
    conic-gradient(
      from 0deg,
      hsl(210 70% 82% / var(--base-glow)) 0 100%
    );
}

[data-touch-phase="idle"][data-summary-status="loading"]::after {
  opacity: 1;
  --spark-visibility: 1;
  --fuse-strength: 0;
  --surge: 0;
  --base-glow: 0.1;
  background:
    conic-gradient(
      from var(--border-angle),
      transparent 0%,
      hsl(210 95% 76%) 2%,
      hsl(210 90% 82%) 4.5%,
      hsl(210 70% 88% / 0.3) 9.5%,
      transparent 12%,
      transparent 100%
    ),
    conic-gradient(
      from 0deg,
      hsl(210 70% 82% / var(--base-glow)) 0 100%
    );
  transition: opacity 300ms ease;
}

/* Arrival (loading → available): flash then fade out */
[data-touch-phase="idle"][data-summary-status="available"]::after {
  opacity: 0;
  --spark-visibility: 0;
  --fuse-strength: 0;
  --surge: 0;
  --base-glow: 0;
  background: conic-gradient(from 0deg, hsl(210 95% 80% / 0.9) 0 100%);
  animation: arrival-flash 450ms ease-out both;
  transition: none;
}

@keyframes spark-orbit {
  to { --border-angle: 360deg; }
}

@keyframes circuit-surge {
  0% { --surge: 0; }
  55% { --surge: 0; }
  70% { --surge: 1; }
  100% { --surge: 0; }
}

@keyframes arrival-flash {
  0% { opacity: 1; }
  28% { opacity: 1; }
  100% { opacity: 0; }
}

@media (prefers-reduced-motion: no-preference) {
  [data-touch-phase="idle"][data-summary-status="loading"]::after {
    animation: spark-orbit 2.5s linear infinite;
  }

  [data-touch-phase="released"][data-summary-status="loading"]::after {
    animation: circuit-surge 220ms ease-out both, spark-orbit 2.5s linear infinite;
  }
}

@media (prefers-reduced-motion: reduce) {
  [data-touch-phase="idle"][data-summary-status="loading"]::after {
    animation: none;
    background:
      conic-gradient(
        from 45deg,
        transparent 0%,
        hsl(210 95% 76%) 3%,
        hsl(210 90% 82%) 7%,
        hsl(210 70% 88% / 0.25) 14%,
        transparent 16%,
        transparent 100%
      ),
      conic-gradient(from 0deg, hsl(210 70% 82% / 0.12) 0 100%);
  }
}
